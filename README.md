# Документация проекта ParticleAnalysis

## О проекте

ParticleAnalysis — это программное обеспечение с графическим интерфейсом пользователя (GUI) для анализа движения частиц методами PIV (Particle Image Velocimetry) и PTV (Particle Tracking Velocimetry). Программа разработана для работы с 16-битными PNG изображениями, полученными с двух камер, и предоставляет удобный интерфейс для выполнения всех этапов обработки данных — от начальной сортировки изображений до получения финальных результатов анализа.

**Ключевые особенности GUI интерфейса:**
- Интуитивно понятное управление всеми модулями обработки
- Визуальный выбор входных папок и параметров обработки
- Интерактивная настройка пороговых значений для фильтрации и бинаризации
- Предварительный просмотр результатов обработки
- Пошаговое выполнение этапов анализа с отображением прогресса
- Визуализация результатов PIV и PTV анализа непосредственно в интерфейсе

## Структура проекта

Проект организован в модульную архитектуру, состоящую из пяти основных модулей:

### 1. Модуль начальной обработки данных
Отвечает за организацию и предварительную обработку входных данных.

**Основные функции:**
- Создание выходной папки с названием `[имя_входной_папки]_cam_sorted`
- Создание внутренней структуры папок: `cam_1/` и `cam_2/`
- Сортировка фотографий из входной папки по алгоритму:
  - Первые две фотографии → `cam_1/` (с отражением относительно горизонтальной оси)
  - Следующие две фотографии → `cam_2/` (без изменений)
  - Цикл повторяется для всех изображений
- Отражение изображений для cam_1 относительно горизонтальной оси (flip по оси X)
- Вывод информации о количестве пар изображений в `cam_1` и `cam_2`
- Валидация формата изображений (проверка 16-битного формата PNG)

**Формат входных данных:**
- Формат изображений: PNG (16-битный)

**Пример работы модуля:**
```
Входная папка: experiment_2024/
Содержимое: img_001.png, img_002.png, img_003.png, img_004.png, img_005.png, img_006.png

Результат:
experiment_2024_cam_sorted/
├── cam_1/
│   ├── img_001.png  (отзеркалено по горизонтали)
│   ├── img_002.png  (отзеркалено по горизонтали)
│   ├── img_005.png  (отзеркалено по горизонтали)
│   └── img_006.png  (отзеркалено по горизонтали)
└── cam_2/
    ├── img_003.png  (без изменений)
    └── img_004.png  (без изменений)

Вывод информации:
- cam_1: 2 пары изображений (отзеркалены)
- cam_2: 1 пара изображений
```

### 2. Модуль фильтрации по интенсивности
Отвечает за обработку 16-битных изображений с применением фильтрации по заданной пользователем интенсивности.

**Основные функции:**
- Загрузка 16-битных PNG изображений из папок `cam_1/` и `cam_2/`
- Фильтрация пикселей по пороговым значениям интенсивности
- Сохранение обработанных изображений для дальнейшего PIV анализа

**Параметры:**
- Пороговое значение интенсивности (диапазон: 0-65535 для 16-битных изображений)
- Тип фильтрации: минимальный порог, максимальный порог или диапазон значений

### 3. Модуль бинаризации
Выполняет бинаризацию изображений для последующего PTV анализа.

**Основные функции:**
- Загрузка 16-битных PNG изображений из папок `cam_1/` и `cam_2/`
- Применение порогового значения к 16-битным изображениям
- Преобразование изображения в бинарный формат (0 или 255)
- Подготовка данных для идентификации частиц

**Параметры:**
- Пороговое значение бинаризации (диапазон: 0-65535 для 16-битных изображений)
- Пиксели со значением выше порога → белые (255)
- Пиксели со значением ниже порога → черные (0)

### 4. Модуль PIV (Particle Image Velocimetry)
Реализует алгоритм PIV для вычисления векторных полей скоростей.

**Основные функции:**
- Загрузка отфильтрованных изображений
- Разбиение изображения на ячейки 128×128 пикселей
- Кросс-корреляционный анализ между последовательными кадрами
- Вычисление векторов смещения и скоростей
- Визуализация векторных полей
- Сохранение результатов PIV анализа

### 5. Модуль PTV (Particle Tracking Velocimetry)
Реализует алгоритм PTV для отслеживания траекторий отдельных частиц.

**Основные функции:**
- Загрузка бинаризованных изображений
- Идентификация частиц на бинаризованных изображениях
- Отслеживание частиц между последовательными кадрами
- Построение траекторий движения частиц
- Вычисление скоростей отдельных частиц
- Сохранение результатов PTV анализа

## Схема работы
```
Входная папка с 16-битными PNG изображениями
         |
         v
Модуль начальной обработки данных
(сортировка по камерам + отражение cam_1)
         |
         v
[папка]_cam_sorted/
├── cam_1/ (пары 1, 3, 5, ... отзеркалены по горизонтали)
└── cam_2/ (пары 2, 4, 6, ... без изменений)
         |
         ├─────────────────────────────────┐
         |                                 |
         v                                 v
Модуль фильтрации              Модуль бинаризации
по интенсивности               (16-битные PNG из cam_1 и cam_2)
(порог: 0-65535)               (порог: 0-65535)
         |                                 |
         v                                 v
Отфильтрованные                Бинаризованные
изображения                    изображения
         |                                 |
         v                                 v
   Модуль PIV                        Модуль PTV
         |                                 |
         v                                 v
Векторные поля                  Траектории частиц
скоростей                       и скорости
```

## Структура каталогов
```
ParticleAnalysis/
├── docs/                    # Документация
├── src/                     # Исходный код
│   ├── data_preprocessing/ # Модуль начальной обработки
│   │   └── cam_sorter.py
│   ├── filters/            # Модули фильтрации
│   │   ├── intensity_filter.py
│   │   └── binarization.py
│   ├── piv/                # Модуль PIV
│   │   └── piv_analysis.py
│   ├── ptv/                # Модуль PTV
│   │   └── ptv_analysis.py
│   ├── gui/                # Графический интерфейс
│   │   └── main_window.py # Главное окно приложения
│   └── utils/              # Вспомогательные функции
├── tests/                   # Тесты
├── examples/               # Примеры данных
└── README.md
```

## Работа с GUI интерфейсом

Графический интерфейс программы обеспечивает последовательное выполнение всех этапов обработки:

1. **Выбор входных данных**: выбор папки с исходными изображениями
2. **Сортировка по камерам**: запуск модуля начальной обработки данных
3. **Настройка параметров**:
   - Установка пороговых значений для фильтрации по интенсивности
   - Установка пороговых значений для бинаризации
4. **Выбор метода анализа**: PIV или PTV (или оба)
5. **Запуск обработки**: выполнение выбранных модулей с отображением прогресса
6. **Просмотр результатов**: визуализация векторных полей или траекторий частиц

Все настройки и параметры доступны через интуитивно понятный интерфейс с подсказками и валидацией введенных значений.

## Рабочая директория после обработки
```
experiment_2024_cam_sorted/
├── cam_1/                  # Изображения с нечетных пар (отзеркалены)
│   ├── img_001.png        # ← отражено по горизонтали
│   ├── img_002.png        # ← отражено по горизонтали
│   ├── img_005.png        # ← отражено по горизонтали
│   └── img_006.png        # ← отражено по горизонтали
└── cam_2/                  # Изображения с четных пар (оригинал)
    ├── img_003.png        # ← без изменений
    ├── img_004.png        # ← без изменений
    ├── img_007.png        # ← без изменений
    └── img_008.png        # ← без изменений
```

**Информация о сортировке:**
- Количество пар в cam_1: N (все изображения отзеркалены относительно горизонтальной оси)
- Количество пар в cam_2: N (или N-1, если общее количество изображений нечетное)